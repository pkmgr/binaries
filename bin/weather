#!/usr/bin/env bash
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
APPNAME="$(basename "$0")"
USER="${SUDO_USER:-${USER}}"
HOME="${USER_HOME:-${HOME}}"
SRC_DIR="${BASH_SOURCE%/*}"
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#set opts

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
##@Version       : 202103202031-git
# @Author        : Jason Hempstead
# @Contact       : jason@casjaysdev.com
# @License       : WTFPL
# @ReadME        : weather --help
# @Copyright     : Copyright: (c) 2021 Jason Hempstead, CasjaysDev
# @Created       : Saturday, Mar 20, 2021 20:31 EDT
# @File          : weather
# @Description   : weather in your console
# @TODO          :
# @Other         :
# @Resource      :
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Import functions
CASJAYSDEVDIR="${CASJAYSDEVDIR:-/usr/local/share/CasjaysDev/scripts}"
SCRIPTSFUNCTDIR="${CASJAYSDEVDIR:-/usr/local/share/CasjaysDev/scripts}/functions"
SCRIPTSFUNCTFILE="${SCRIPTSAPPFUNCTFILE:-testing.bash}"
SCRIPTSFUNCTURL="${SCRIPTSAPPFUNCTURL:-https://github.com/dfmgr/installer/raw/master/functions}"
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
if [ -f "$PWD/$SCRIPTSFUNCTFILE" ]; then
  . "$PWD/$SCRIPTSFUNCTFILE"
elif [ -f "$SCRIPTSFUNCTDIR/$SCRIPTSFUNCTFILE" ]; then
  . "$SCRIPTSFUNCTDIR/$SCRIPTSFUNCTFILE"
else
  echo "Can not load the functions file: $SCRIPTSFUNCTDIR/$SCRIPTSFUNCTFILE" 1>&2
  exit 1
fi
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# user system devenv dfmgr dockermgr fontmgr iconmgr pkmgr systemmgr thememgr wallpapermgr
user_install
__options "$@"
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
__am_i_online_err
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
LOCID="${MYLOCATIONID:-$2}"
API="http://wttr.in"
API2="http://v2.wttr.in"
APIACCU="http://api.wunderground.com/auto/wui/geo/ForecastXML/index.xml"
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
__mkd "$HOME/.local/tmp"
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
report() { printf_color "Weather report for $LOCID\n" "21"; }
grep_v() { grep -v "Weather report" | grep -v "Location"; }
wttrin() { __curl "$API/$LOCID?AFu$2" | grep_v && report; }
wttrin2() { __curl -LSs "$API2/$LOCID?AFu$2" | grep_v && report; }
wttrimage() { __curl -LSsq "$API/$LOCID?AFuw.png" -o "$HOME/.local/tmp/weather.png"; }
wttrcity() { __curl -LSsq "$API/$MYLOCATIONZIP?AFu$2" | grep -v "Weather report" | head -n 6 && echo ""; }
wttrmoon() { __curl -LSs "$API/moon?AFu$2"; }
wttrsimple() { __curl -LSs "$API/$LOCID?format=3"; }
wttraccuweather() { __curl -s "$APIACCU?query=${*:-$MYLOCATIONID}" | perl -ne '/<title>([^<]+)/&&printf "%s: ",$1;/<fcttext>([^<]+)/&&print $1,"\n"'; }
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

case "$1" in
help | -h | --help)
  __help
  ;;
city | -c | --city)
  shift 1
  LOCID="${MYLOCATIONZIP:-$1}"
  [ -z "$LOCID" ] && __help
  [ "$1" = "--help" ] && printf_help "Usage: $APPNAME city zipcode"
  wttrcity "$@"
  ;;
v2 | -v2 | --v2)
  shift 1
  LOCID="${MYLOCATIONID:-$1}"
  [ -z "$LOCID" ] && __help
  [ "$1" = "--help" ] && printf_help "Usage: $APPNAME v2 zipcode"
  wttrin2 "$@"
  ;;
img | -i | --img | image | --image)
  shift 1
  LOCID="${MYLOCATIONID:-$1}"
  [ -z "$LOCID" ] && __help
  [ "$1" = "--help" ] && printf_help "Usage: $APPNAME img zipcode"
  wttrimage "$@"
  ;;
moon | -m | --moon)
  shift 1
  LOCID="${MYLOCATIONZIP:-$1}"
  [ -z "$LOCID" ] && __help
  [ "$1" = "--help" ] && printf_help "Usage: $APPNAME moon"
  wttrmoon "$@"
  ;;
simple | -simple | --simple)
  shift 1
  LOCID="${MYLOCATIONID:-$1}"
  [ -z "$LOCID" ] && __help
  [ "$1" = "--help" ] && printf_help "Usage: $APPNAME simple"
  wttrsimple "$@"
  ;;
accu | accuweather)
  shift 1
  LOCID="${MYLOCATIONID:-$1}"
  [ -z "$LOCID" ] && __help
  [ "$1" = "--help" ] && printf_help "Usage: $APPNAME accuweather"
  wttraccuweather "$@"
  ;;
*)
  shift 0
  LOCID="${MYLOCATIONID:-$1}"
  [ -z "$LOCID" ] && __help
  [ "$1" = "--help" ] && __help
  wttrin "$@"
  ;;
esac
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
exit $?
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# end
